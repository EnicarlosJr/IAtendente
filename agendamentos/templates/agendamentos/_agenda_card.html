{# templates/agendamentos/_agenda_card.html #}

{% if row.item %}
  {% with status_code=row.item.status|stringformat:"s"|upper %}
    {% url 'solicitacoes:detalhe' shop.slug row.item.id as detail_url %}

    <div class="relative rounded-xl border p-4 shadow-sm hover:shadow-md hover:border-slate-300 transition">
      <!-- Bolinha lateral (status) -->
      <span class="absolute left-4 top-6 w-3 h-3 rounded-full
          {% if status_code in 'CONFIRMADA CONFIRMADO' %} bg-blue-500
          {% elif status_code == 'PENDENTE' %} bg-amber-500
          {% elif status_code in 'NEGADA CANCELADA' %} bg-rose-500
          {% else %} bg-slate-400 {% endif %}">
      </span>

      <!-- Topo: Hora + Status (hora clic√°vel) -->
      <div class="flex justify-between items-center">
        <a href="{{ detail_url }}" class="text-lg font-bold text-slate-900 hover:underline">
          {{ row.time|date:"H:i" }}
        </a>
        <span class="pill text-[11px] font-medium
            {% if status_code in 'CONFIRMADA CONFIRMADO' %} bg-blue-100 text-blue-700
            {% elif status_code == 'PENDENTE' %}            bg-amber-100 text-amber-800
            {% elif status_code in 'NEGADA CANCELADA' %}     bg-rose-100 text-rose-700
            {% else %}                                       bg-slate-100 text-slate-700 {% endif %}">
          {% firstof row.item.status_label row.item.status %}
        </span>
      </div>

      <!-- Cliente + Servi√ßo (tamb√©m clic√°vel como linha secund√°ria) -->
      <a href="{{ detail_url }}" class="mt-2 block">
        <p class="text-sm font-semibold text-slate-900 truncate">{{ row.item.cliente_nome }}</p>
        <p class="text-xs ia-text-muted truncate">{{ row.item.servico_nome }}</p>
      </a>

      {# A√ß√µes para SOLICITA√á√ÉO pendente (can_act vem setado na view) #}
      {% if row.item.is_solicitacao and row.item.can_act %}
        <div class="mt-3 flex justify-end gap-2">
          <form method="post" action="{{ row.item.confirm_url }}">
            {% csrf_token %}
            <button class="btn btn-primary btn-xs">‚úÖ Confirmar</button>
          </form>
          <form method="post" action="{{ row.item.deny_url }}">
            {% csrf_token %}
            <button class="btn btn-danger btn-xs">‚ùå Negar</button>
          </form>
        </div>
      {% endif %}
    </div>
  {% endwith %}

{% elif row.occupied %}
  <!-- Ocupado -->
  <div class="rounded-xl border border-slate-200 bg-slate-50 p-4 flex justify-between items-center shadow-sm">
    <span class="text-lg font-bold text-slate-900">{{ row.time|date:"H:i" }}</span>
    <span class="text-xs ia-text-muted flex items-center gap-1">‚è≥ Em atendimento</span>
  </div>

{% elif not row.available and row.reason == 'almoco' %}
  <!-- Almo√ßo -->
  <div class="rounded-xl border border-amber-200 bg-amber-50 p-4 flex justify-between items-center shadow-sm">
    <span class="text-lg font-bold text-slate-900">{{ row.time|date:"H:i" }}</span>
    <span class="text-sm text-amber-700 flex items-center gap-1">üçΩÔ∏è Intervalo</span>
  </div>

{% elif not row.available and row.reason == 'folga' %}
  <!-- Folga -->
  <div class="rounded-xl border border-slate-200 bg-slate-50 p-4 flex justify-between items-center shadow-sm">
    <span class="text-lg font-bold text-slate-900">{{ row.time|date:"H:i" }}</span>
    <span class="text-sm ia-text-muted flex items-center gap-1">üõë Indispon√≠vel</span>
  </div>

{% else %}
  <!-- Dispon√≠vel -->
  <a href="{% url 'solicitacoes:solicitacoes' shop.slug %}?inicio={{ row.time|date:'Y-m-d\\TH:i' }}"
     class="rounded-xl border border-dashed border-emerald-300 bg-white p-4 hover:bg-emerald-50 hover:shadow-md hover:border-emerald-400 transition flex justify-between items-center shadow-sm">
    <span class="text-lg font-bold text-slate-900">{{ row.time|date:"H:i" }}</span>
    <span class="text-sm text-emerald-700 flex items-center gap-1">‚ûï Dispon√≠vel</span>
  </a>
{% endif %}

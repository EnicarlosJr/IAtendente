{# barbearias/templates/barbearias/fluxo.html #}
{% extends "painel/base.html" %}
{% load tz %}

{% block title %}Fluxo de pessoas{% endblock %}
{% block header %}Fluxo de pessoas{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl space-y-6">

  <div class="card p-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold">Resumo</h2>
      <div class="text-sm text-slate-500">Loja: <span class="font-medium">{{ shop.nome }}</span></div>
    </div>
    <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3">
      {% if stats %}
        {% for row in stats %}
          <div class="rounded-xl border p-3 bg-white">
            <div class="text-xs text-slate-500">Tipo</div>
            <div class="text-sm font-medium">{{ row.kind }}</div>
            <div class="mt-2 text-2xl font-bold">{{ row.total }}</div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-sm text-slate-600">Sem estatísticas no período.</p>
      {% endif %}
    </div>
  </div>

  <div class="card overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50 text-left">
        <tr>
          <th class="px-4 py-2">Quando</th>
          <th class="px-4 py-2">Usuário</th>
          <th class="px-4 py-2">Tipo</th>
          <th class="px-4 py-2">IP</th>
          <th class="px-4 py-2">Path</th>
          <th class="px-4 py-2">User-Agent</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        {% for ev in events %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-2 whitespace-nowrap">{{ ev.created_at|localtime|date:"d/m/Y H:i" }}</td>
          <td class="px-4 py-2 whitespace-nowrap">
            {% if ev.user %}{{ ev.user.get_full_name|default:ev.user.username }}{% else %}—{% endif %}
          </td>
          <td class="px-4 py-2">{{ ev.kind }}</td>
          <td class="px-4 py-2">{{ ev.ip|default:"—" }}</td>
          <td class="px-4 py-2">{{ ev.path|default:"—" }}</td>
          <td class="px-4 py-2 truncate max-w-[320px]">{{ ev.user_agent|default:"—" }}</td>
        </tr>
        {% empty %}
        <tr>
          <td class="px-4 py-6 text-center text-slate-500" colspan="6">Nenhum evento encontrado.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}

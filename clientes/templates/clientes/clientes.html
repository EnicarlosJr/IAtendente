{% extends "painel/base.html" %}
{% block title %}Clientes{% endblock %}
{% block header %}Clientes{% endblock %}

{% block content %}
<div class="mx-auto max-w-7xl px-4 py-6">
  <div class="bg-white rounded-2xl border border-gray-200 shadow-sm">
    <div class="flex items-center justify-between gap-2 px-4 py-3 border-b">
      <h1 class="text-lg font-semibold text-gray-900">Clientes</h1>
      <a href="{% url 'clientes:novo' %}" class="rounded-xl bg-blue-600 text-white px-3 py-2 text-sm hover:bg-blue-700">+ Novo cliente</a>
    </div>

    <form method="get" class="px-4 pt-3 pb-4 flex flex-wrap items-center gap-2">
      <input type="text" name="q" value="{{ filters.q|default_if_none:'' }}"
             class="rounded-xl border px-3 py-2 w-full sm:w-64" placeholder="Buscar por nome ou telefone">
      <select name="status" class="rounded-xl border px-3 py-2">
        <option value="">Status</option>
        <option value="ATIVO"   {% if filters.status == 'ATIVO' %}selected{% endif %}>Ativo</option>
        <option value="INATIVO" {% if filters.status == 'INATIVO' %}selected{% endif %}>Inativo</option>
      </select>
      <button class="rounded-xl px-4 py-2 bg-black text-white text-sm">Filtrar</button>
      <a href="{% url 'clientes:lista' %}" class="rounded-xl px-4 py-2 border hover:bg-gray-50 text-sm">Limpar</a>
    </form>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50 text-left">
          <tr>
            <th class="px-4 py-3 font-semibold">Cliente</th>
            <th class="px-4 py-3 font-semibold">Telefone</th>
            <th class="px-4 py-3 font-semibold">Último corte</th>
            <th class="px-4 py-3 font-semibold">Status</th>
            <th class="px-4 py-3 font-semibold text-right">Ações</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          {% for c in clientes %}
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3">
              <div class="font-medium">{{ c.nome }}</div>
              {% if c.barbeiro_preferido %}
                <div class="text-xs text-gray-500">Preferência: {{ c.barbeiro_preferido }}</div>
              {% endif %}
            </td>
            <td class="px-4 py-3">{{ c.telefone|default:"—" }}</td>
            <td class="px-4 py-3">
              {% if c.ultimo_corte %}{{ c.ultimo_corte|date:"d/m/Y H:i" }}{% else %}—{% endif %}
            </td>
            <td class="px-4 py-3">
              {% if c.recorrencia_status == 'ATIVO' %}
              <span class="inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2 py-0.5 text-emerald-800">● Ativo</span>
              {% else %}
              <span class="inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-0.5 text-gray-800">● Inativo</span>
              {% endif %}
            </td>
            <td class="px-4 py-3">
              <div class="flex justify-end gap-2">
                <a href="{% url 'clientes:detalhe' c.id %}" class="rounded-xl border px-3 py-1.5 hover:bg-gray-50">Abrir</a>
                <a href="{% url 'clientes:editar' c.id %}" class="rounded-xl border px-3 py-1.5 hover:bg-gray-50">Editar</a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Nenhum cliente encontrado.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if page_obj.paginator.num_pages > 1 %}
    <div class="px-4 py-3 flex items-center justify-between">
      <div class="text-sm text-gray-600">
        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }} · {{ page_obj.paginator.count }} registros
      </div>
      <div class="flex items-center gap-2">
        {% if page_obj.has_previous %}
          <a class="rounded-xl border px-3 py-1.5 hover:bg-gray-50"
             href="?{% if request.GET %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_obj.previous_page_number }}">Anterior</a>
        {% else %}
          <span class="rounded-xl border px-3 py-1.5 text-gray-400">Anterior</span>
        {% endif %}
        {% if page_obj.has_next %}
          <a class="rounded-xl border px-3 py-1.5 hover:bg-gray-50"
             href="?{% if request.GET %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_obj.next_page_number }}">Próxima</a>
        {% else %}
          <span class="rounded-xl border px-3 py-1.5 text-gray-400">Próxima</span>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
